sudo: required

language: c

env:
  global:
    - secure: "tikkEdzV2V6CPAmoRDsM44aEngMYKozaag0gtK12kvDPOPS5UuR0Lc6ZOaKzYI0XMHSo2tmTuAoNDYzElw962OQyc2VgJEJ5/Wup/2LE6L0d6QM4UddRaNGY4zKZ+2jQ/nS5IT1dII0/yVrwJFoUm7Jgzq0C6fQM1gGdJ6B86cCmEXmJsyX8PLgGkQdyFgRIHrEJXXqyHqEYz9n9/sBLM7L22xe50XSc9MO46eA4H5xzCy1d6ONROe3elbj7UpqPs8ilTVliDQrfn5J7CoSiJeGHosaqTzBkPAcolhsOqG1lDK7zEyY/XIv6mVnfso4Xwh37HRmrpz1oMTVjpttgsHf0wX074V1nEp9IrqAqdtDpQSYt7A7mj9oOTrPzweZG7+ISod+IVvBU4Qfv6WDJPEpBNvXjkf5tAa2QJCl3CtlC0M9q7xFobdmaSPCvCged8Y/CLIL4m8dmJ3e50q4pXa58c0ZUwzGVM844S22SrJc8LgQuIUor+gklmwfOpnh8Dnq9cSoEsP5rYQFY7WWT/ii/uHzmHCm1H4lfIoEvSKNLKGvSeonWZtDhEsYTaHJt9r6VdUjRahFhywFcBLWCuEC7udLK5Dd5mESO9C2Vq+prUI9VZ2sOvDwO8bjmodzeDPpZwlKTHEGLljPddahCOqoLZD2kNgPts94qaLL57ws="
    - secure: "Pekpe7lUOdloE/nfBkV11Z+4Z8VmUcvx+x9aqs4ydqsXvKEhZiUcQKoipJyooydF8UQEHNKavapHJrSBiFg3URAFnpsobVCxmUrXYhIO5VSYlVdSq4966q7dS6Lvq6EPWJevpPnzcmuN91HDzgeIOSWZVu4S3uQmMOTWQKewZqnlpLXn5wrmyoDvq4vrunTLba53+BKRGgmFcWle4f2cruJv8Gb9Lrtw85n2lO7N//srScm/U1+46U9U81vzYYbVoVGU9/a0EJVV+z8jSoM3iTtt7qwqBvNQ8mhuXkB2a2y+XgCl8Q2C0BOjuKRvoi6wx7uZCfezcIcB14XDEmtE7VakErciVMpHZjvBeG8IWuSu91zZK8jeXnFxFSXUQoj+nwmdDpmjVctHJ8z7ukb0r9aBPhYufcidM1rREmAiUSrt8yZr9RiFYQagPQluw1VVCidDxyBMzVoQyPERdIQTPdIqsdHx6YoY704LnPOoRplC31EBG8qjtyvVj6ALXM/UiIInP/LTyxuYmugxoQsvz2photcdW3spIcvd886pWttFy6twvwaeSwDdBtv8iDB3PygH8ZatWrfrK1VtZnK32kqOXTvjxaW9C+Psh+I74w9er1WEVWhkKQSRKp7OoKHu9giqTM6neOeOR0za3cvfPG0nPxX+jCfsgxHF2Rco+Xw="
    - secure: "A3hGQ0Z916rRISbNrJ7pr3/T8tXZnOkdFV5D/k0+Q4hxfTHIepJkz1PbCXxnu/ZfdQsYoShbrzodothXJiBNh1eNhL47A6jLb87Oiml6IOmL7kp8uCGrb455YXhWgorrVQ2YNOERgkesNnuFEdawSDeLsOcCCu/lx9B5BEF0LKVmRSwywc145UcMqmhvudbA8dcaJIh7NZhGx68LcqssTkH0LUnTIXKwPn8aVBzKc7ckHwvr+AzJSwwt9Br/St0BKhcdIiFcIkrhxs6XNCM8DqrASDYnuQUyuEOeY3iabhAMnTQrAhW7GgX4vkcX3lp+EPzFkcUVCtXag58ApwV9fYW0UOqMrzT2brB73cxQcUkU+i1wbxa1qnpXcml9dzi7XacH5y1HZ/jAOK0j1RqMA/bT1ilrnNCeh/HSjjfR5+T7IvsjYYKYx/lzaIBbN2kmnXEFwRamaOA87AzdMHOqgOVfeIr/UNIHjOo3nzVAKplXEsJ1rz2LocT+JjWGjPHUdttoWmdsOxougW4X321E2iwG6WFqxfLjtddXQRH5XN+Zjy1DGBQ5JjJRU5LdMywLqTqwWlHhTHCl8A4MZr4xX1xaiSIwWvU1HD3tk9MyVwgtECdVOJfEiUU5OrSERmrGe/Kp7/MUqnFJqyFNRlSH5N+9OPGdbF5EHSMF245VVBQ="
    - secure: "sTbn8+QIntrEq+41og/sya8CVYWgtOlntewYXbAXLlqXSOuBLq4eHVq1VtCPRaf4NYR90x4VCoN4rTyJ2LJjO15/hZxDDPeN60B9J1C1mNt6jAhkNkq7o+4NeQxXgdmfp+xh0N1zKmO5+mndxJ9JMrbSMTbv6uXGL3EedhIpI2NeviMvPTOl0MsI0iOBlVa3Wl5bHzR4O1z73Xjr2iauJHlf1iQEU4iQY2jULRqoWab006S1VrploNYg5HVDeO6FI+7t7H5zUBBZgusv6HeHTym9HuYG2vnF+s1UgT20ZSRnwpcw21Jy5kNC1VpnunOkY9woAsBiRWIZu+j2kmxdkCzJqD+NzFAu4cPPv5FD3kt2cktkXnuBGrw4iVUOSiGTzmrR5RDEoCPHvjP18wG8r0AGf9awRYrzEvzN/Lp+sbRfb5O8c6oeYWiI6XBUY40/2ZogKmFKo5dCAJexk8GyjJYmDhvgC56KW8Fz4MOI1lXWV7V7KLud4tiYKUKpr2IRLHaCS3v+zBmQBWjz8Tq4C/V/WGBeqJvEtRuwq5l7EdGqNYotMbkflI83Ne1ZZMTubG9SpTlokGtsiXfJuoUAVAc5CMXetQe1Y4MpJwpBcQGg8lvF8ANFZsrYaODe1VEQ6Xr6f/I3YQCyOrih3uCUKdk/mCY1U3OMzLjVW49rG9I="
    - secure: "Xk45UFBx00ywBfg8Z4v6rCVZND262CclxA9xoQW88OIV2zJlTOu1uH0W0wR4HngahLv0uTHMC3tAibyjrNHfa4fAJ5BwqCIliu4wu1Ki3ZRiyJJhaqMYdaGawnPY7jhUAKy61M4pEysSdIjGV4g5xP6GT0yVE2bfL5GKASjU52BG57knmGNCTM9givtzhGRftVYIR3mafdIBz7K5SZW7UIRDq7exQ+5n9tqvzLcy98z2snpeVlH69c53zc1q6lYyb8Giv9jSL4j/fisQ6GiSfSR+Z7zfJIQDq0NhPska1j6V3yEJQUqpW7XmdHBl8M5hcZ0gyyJcFMc+/7DLKFYhU9YRU086GIs6FVjjoLgF5Bi3gwsNH4vOZ1RWOCosd8Sm4oW3pH9M6TjMzDUtGTPqk1nbjtOsWmWhfvwMJRLYc7iGhyazOaS20FBDq/2giUk8RqJoguFhK39p4CP9Xv1+BJJRiqctB7S7+QYoA158m3QMZmir6s+slBI80l82hoBC7ja7kPwwzZEFOTijYenzEUqwxU9evKL7TnlV8W161rLX9ZWzlxdn+urZuB7yZ/ZuimCQKyyCcehxYMO9jzVSmuzYWIbplUMleBMgA89yARuzzEUdj8tblUiUr/1U7LHD4xrN2J1M5/LMEXmR5ZP7zB23oY3P1bFE9syWkVk63PM="
    - COMMIT=${TRAVIS_COMMIT::8}
    - export REPO=okdocker/pynode
  matrix:
    - PYTHON_VERSION=3.6 NODE_VERSION=8 NODE_ALIAS=lts
    - PYTHON_VERSION=3.6 NODE_VERSION=9 NODE_ALIAS=previous
    - PYTHON_VERSION=3.6 NODE_VERSION=10 NODE_ALIAS=latest
    - PYTHON_VERSION=3.7 NODE_VERSION=8 NODE_ALIAS=lts
    - PYTHON_VERSION=3.7 NODE_VERSION=9 NODE_ALIAS=previous
    - PYTHON_VERSION=3.7 NODE_VERSION=10 NODE_ALIAS=latest

install:
  - curl -O -L https://github.com/grammarly/rocker/releases/download/1.3.1/rocker-1.3.1-linux_amd64.tar.gz
  - tar xvfz rocker-1.3.1-linux_amd64.tar.gz

script:
  - ./rocker build --auth $DOCKER_USER:$DOCKER_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=$REPO:$PYTHON_VERSION-$NODE_VERSION.x -var PythonVersion=$PYTHON_VERSION -var NodeVersion=$NODE_VERSION
  - ./rocker build --auth $DOCKER_USER:$DOCKER_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=$REPO:$PYTHON_VERSION-$NODE_ALIAS -var PythonVersion=$PYTHON_VERSION -var NodeVersion=$NODE_VERSION
  - ./rocker build --auth $QUAY_USER:$QUAY_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=quay.io/$REPO:$PYTHON_VERSION-$NODE_VERSION.x -var PythonVersion=$PYTHON_VERSION -var NodeVersion=$NODE_VERSION
  - ./rocker build --auth $QUAY_USER:$QUAY_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=quay.io/$REPO:$PYTHON_VERSION-$NODE_ALIAS -var PythonVersion=$PYTHON_VERSION -var NodeVersion=$NODE_VERSION

